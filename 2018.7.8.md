
#  IPFS (InterPlanetary File System)

### 什么是InterPlanetary File System

一个点对点的超媒体网络传输协议，IPFS 中的所有节点共同构成了一个分布式的文件存储与分发系统。它的目标是取代传统的 HTTP 协议，创建一个更快更安全以及更加开放的网络。

它的出现就是为了解决 HTTP 现存的缺点：按照传统的 HTTP 协议标准访问一个网络中的资源，需要先解析域名找到服务器的 IP 地址，再通过该 IP 向服务器发起请求，如果该文件已经被服务器删除，那么就会返回 404（IPFS 中没有删除文件的广播命令）。传统的中心化架构依赖单个服务器、有限的集群以及 Internet 主干网，容易遭受 DDOS 攻击，出现单点故障。

使用 HTTP 协议每次需要从中心化的服务器下载完整的文件(网页, 视频, 图片等), 速度慢, 效率低. 如果改用 P2P 的方式下载, 可以节省近 60% 的带宽. P2P 将文件分割为小的块, 从多个服务器同时下载, 速度非常快.

### 工作原理

IPFS 为每个文件根据其内容计算出一个唯一的 HASH，每个节点储存部分文件数据以及确定每个文件所在节点位置的分布式哈希表。用户访问文件时提供文件的 HASH，依据哈希表找到文件并返回文件数据。与 CDN 不同的是，每个 IPFS 节点都是一个数据源，不需要再从中心服务器获取数据。它具有内容可寻址的特点，通过文件内容生成唯一的哈希标识，一定程度上节约了空间开销的成本。

本质上是一种内容可寻址、版本化、点对点超媒体的分布式存储、传输协议，目标是补充甚至取代过去20年里使用的超文本媒体传输协议（HTTP），希望构建更快、更安全、更自由的互联网时代。

+ IPFS 是一个协议，类似 http 协议
  - 定义了基于内容的寻址文件系统
  - 内容分发
  - 使用的技术分布式哈希、p2p 传输、版本管理系统

+ IPFS 是一个文件系统
  - 有文件夹和文件
  - 可挂载文件系统

+ IPFS 是一个web协议
  - 可以像 http 那样查看互联网页面
  - 未来浏览器可以直接支持 ipfs:/ 或者 fs:/ 协议

+ IPFS 是模块化的协议
  - 连接层：通过其他任何网络协议连接
  - 路由层：寻找定位文件所在位置
  - 数据块交换：采用 BitTorrent 技术

+ IPFS是一个 p2p 系统
  - 世界范围内的p2p文件传输网络
  - 分布式网络结构
  - 没有单点失效问题

+ IPFS天生是一个 CDN
  - 文件添加到 IPFS 网络，将会在全世界进行 CDN 加速
  - bittorrent 的带宽管理

+ IPFS拥有命名服务
  - IPNS：基于 SFS（自认证系统）命名体系
  - 可以和现有域名系统绑定

其中 LibP2P 是 IPFS 核心中的核心，面对各式各样的传输层协议以及复杂的网络设备，它可以帮助开发者迅速建立一个可用P2P网络层，快速且节约成本，这也是为什么 IPFS 技术被众多区块链项目青睐的缘由。

IPLD 其实是一个转换中间件，将现有的异构数据结构统一成一种格式，方便不同系统之间的数据交换和互操作。现在 IPLD 支持的数据结构，是比特币、以太坊的区块数据，也支持 IPFS 和 IPLD。这也是 IPFS 为什么受到区块链系统欢迎的原因之二，它的IPLD中间件可以把不同的区块结构统一成一个标准进行传递，为开发者提供了成功性比较高的标准，不用担心性能、稳定和bug。

举个具体场景的例子。假设我想要看《环太平洋》这部电影，小明之前下载过这部电影，他启动了IPFS节点，将这个视频文件加入了IPFS网络。他会得到一个哈希指纹b，同时发布到公共网关，得到了一个<code>/IPFS/b</code>的路径名。

他把哈希指纹和路径名都告诉我，我要做的事情是启动一个本地节点，对该网关发一个寻址 PIN 的请求，IPFS 自动索引分布式哈希表的哈希值，找到指纹b所对应的节点列表。

大的视频通常不会都存在一个节点，可能分片存在其它一些子节点上，IPFS 把这些节点列表全部并行抓取，最后由本地的 manager 拼成完整的文件。并行的速度远远大于直接下载完整文件的速度，我很快就能在本地化的浏览器上看到电影，还可以继续分享给其他人。


### 应用

+ [基于IPFS和Ngrok构建自维护资源网关](https://www.daijiale.cn/%E5%8C%BA%E5%9D%97%E9%93%BE/%E3%80%90ipfs%E3%80%91%E5%9F%BA%E4%BA%8Eipfs%E5%92%8Cngrok%E6%9E%84%E5%BB%BA%E8%87%AA%E7%BB%B4%E6%8A%A4%E8%B5%84%E6%BA%90%E7%BD%91%E5%85%B3%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89.html)
+ [基于IPFS的音乐播放器](http://ipfser.org/2018/05/18/r41/)
+ [IPFS网络是如何运行的(p2p网络)](http://ipfser.org/2018/01/17/r17/)


### 参考
[是时候和 404 说再见了](https://zhuanlan.zhihu.com/p/37077160)
[IPFS官网](https://ipfs.io/docs/getting-started/)
[详解IPFS的本质、技术架构以及应用](http://ipfser.org/2018/03/28/r33/)
